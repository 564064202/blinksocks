"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Pipe=exports.Pipe=function(){function Pipe(props){_classCallCheck(this,Pipe);this._props=null;this._middlewares=[];this._props=props;this.onNotify=this.onNotify.bind(this)}_createClass(Pipe,[{key:"onNotify",value:function onNotify(action){var results=[];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this._middlewares[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var middleware=_step.value;results.push(middleware.onUpdate(action))}// if no middleware handled this action, bubble up to where pipe created.
}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}if(results.every(function(result){return!!result===false})){this._props.onNotify(action)}}},{key:"pipe",value:function pipe(middleware){middleware.subscribe(this.onNotify);this._middlewares.push(middleware);return this}},{key:"feed",value:function feed(buffer){return this._middlewares.reduce(function(prev,next){return prev.then(function(buf){return next.write(buf)})},Promise.resolve(buffer))}}]);return Pipe}();