'use strict';Object.defineProperty(exports,'__esModule',{value:true});exports.Profile=undefined;var _fs=require('fs');var _fs2=_interopRequireDefault(_fs);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const PROFILE_SAMPLE_INTERVAL=1;const now=()=>new Date().getTime();class Profile{static start(){this._timer=setInterval(()=>{this._outSpeed=this._tmpOut/PROFILE_SAMPLE_INTERVAL;this._inSpeed=this._tmpIn/PROFILE_SAMPLE_INTERVAL;this._maxOutSpeed=Math.max(this._maxOutSpeed,this._outSpeed);this._maxInSpeed=Math.max(this._maxInSpeed,this._inSpeed);this._tmpOut=0;this._tmpIn=0},PROFILE_SAMPLE_INTERVAL*1e3)}static stop(){clearInterval(this._timer)}static snapshot(){const endTime=now();const duration=(endTime-this._startTime)/1e3;const totalPackets=this._totalInPackets+this._totalOutPackets;const totalBytes=this._totalIn+this._totalOut;return{sample:{from:this._startTime,to:endTime,duration:endTime-this._startTime},instance:{outSpeed:this._outSpeed,inSpeed:this._inSpeed,connections:this._connections,errors:this._errors,fatals:this._fatals,totalOut:this._totalOut,totalIn:this._totalIn,totalOutPackets:this._totalOutPackets,totalInPackets:this._totalInPackets,totalBytes,totalPackets,errorRate:this._errors?this._errors/totalPackets:0,fatalRate:this._fatals?this._fatals/totalPackets:0,outBytesRate:this._totalOut/duration,outPacketsRate:this._totalOutPackets/duration,inBytesRate:this._totalIn/duration,inPacketsRate:this._totalInPackets/duration,totalBytesRate:totalBytes/duration,totalPacketsRate:totalPackets/duration},summary:{maxOutSpeed:this._maxOutSpeed,maxInSpeed:this._maxInSpeed,maxConnections:this._maxConnections},node:{upTime:process.uptime(),cpu:process.cpuUsage(),memory:process.memoryUsage()}}}static save(){const dt=new Date;const postfix=`${dt.getFullYear()}-${dt.getMonth()+1}-${dt.getDate()}`;const data=JSON.stringify(this.snapshot(),null,'  ');_fs2.default.writeFileSync(`blinksocks.profile-${postfix}.log`,data)}static set connections(value){this._connections=value;this._maxConnections=Math.max(this._maxConnections,this._connections)}static get connections(){return this._connections}static set fatals(value){this._fatals=value}static get fatals(){return this._fatals}static set errors(value){this._errors=value}static get errors(){return this._errors}static set totalOut(value){this._totalOut=value;this._totalOutPackets+=1;this._tmpOut+=value}static get totalOut(){return this._totalOut}static set totalIn(value){this._totalIn=value;this._totalInPackets+=1;this._tmpIn+=value}static get totalIn(){return this._totalIn}}exports.Profile=Profile;Profile._startTime=now();Profile._timer=null;Profile._tmpOut=0;Profile._outSpeed=0;Profile._maxOutSpeed=0;Profile._tmpIn=0;Profile._inSpeed=0;Profile._maxInSpeed=0;Profile._connections=0;Profile._maxConnections=0;Profile._fatals=0;Profile._errors=0;Profile._totalOut=0;Profile._totalOutPackets=0;Profile._totalIn=0;Profile._totalInPackets=0;