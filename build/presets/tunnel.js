'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _defs=require('./defs');var _utils=require('../utils');class TunnelPreset extends _defs.IPreset{constructor({host,port}){super();this._host=null;this._port=null;this._isTunnelReady=false;this._isBroadCasting=false;this._staging=Buffer.alloc(0);if(typeof host!=='undefined'&&!(0,_utils.isValidHostname)(host)){throw Error('host is invalid')}if(typeof port!=='undefined'&&!(0,_utils.isValidPort)(port)){throw Error('port is invalid')}if(host&&port){this._host=host;this._port=port}}handleTunnel({buffer,next,broadcast}){if(!this._isTunnelReady){if(this._isBroadCasting){this._staging=Buffer.concat([this._staging,buffer])}else{this._isBroadCasting=true;broadcast({type:_defs.SOCKET_CONNECT_TO_REMOTE,payload:{host:this._host,port:this._port,onConnected:()=>{next(Buffer.concat([buffer,this._staging]));this._isTunnelReady=true;this._isBroadCasting=false;this._staging=null}}})}}else{return buffer}}clientOut(props){return this.handleTunnel(props)}serverIn(props){return this.handleTunnel(props)}}exports.default=TunnelPreset;